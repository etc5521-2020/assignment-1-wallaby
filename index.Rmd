---
title: "Spotify Music Exploratory Data Analysis"
subtitle: "ETC5521 Assignment 2"
team: wallaby
author: 
  - Helen Evangelina
  - Rahul Bharadwaj
date: "`r Sys.Date()`"
bibliography: references.bib
output: 
  html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(devtools)
library(readr)
library(tidyverse)
library(dplyr)
library(lubridate)
library(ggplot2)
library(skimr)
library(knitr)
library(kableExtra)
library(forcats)
library(broom)
library(gridExtra)
library(genius)
library(tidytext)
library(textdata)
library(DT)
library(corrplot)
library(ggthemes)
#to install the spotifyr package
#install.packages("devtools")
#devtools::install_github('charlie86/spotifyr')
library(spotifyr)
library(ggridges)
library(visdat)
```

```{r read-data, eval=FALSE}
readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv') %>% 
  write.csv("spotify_songs.csv")
```

```{r read-csv}
spotify_songs <- read.csv(here::here("spotify_songs.csv"))
spotify_songs <- spotify_songs %>% 
  mutate(track_artist = replace(track_artist, track_artist == "Ti<U+00EB>sto", "Tijs Michiel Verwest OON"))
```

```{r}
spotify_songs <- spotify_songs %>% 
  mutate(year = substr(track_album_release_date, 1, 4))

spotify_songs <- spotify_songs %>% 
  mutate(decade = round(as.numeric(year) - 4.5, -1))
```


# Music characteristics overtime

(put here or on the introduction?)

* It has been previously discussed about the different music components and the correlation between each, and also `track_popularity`. Another thing that we can look at is the trend of music components overtime. Across the years, more musical instruments and more genres are being introduced, changing our music taste. Therefore, analysing the trend of music components over time is an interesting thing to look at as it would be beneficial to understand how the characteristics of music are changing. As music evolves, we want to look at how the characteristics evolve. Are the music characteristics in 1957 similar to those in 2019? The trend of music genres has been analysed before, which shows that the trend is changing. Therefore, looking at the trend of music components would broaden the analysis more to see if the components are also changing.

```{r characteristics-mean}
characteristics_mean <- spotify_songs %>%
 select(danceability,
        acousticness,
         duration_ms,
        energy,
        instrumentalness,
        key,
        liveness,
        loudness,
        mode,
        speechiness,
        tempo,
        valence,
        year) %>%
  pivot_longer(-year, names_to = "components",
               values_to = "values") %>%
  group_by(year,
           components) %>%
  summarise(mean = mean(values)) %>%
    group_by(year)

characteristics_mean$year <- as.Date(characteristics_mean$year, format = "%Y")
```


```{r components-trend, fig.cap="The trend of music components over the years."}
char_long <- spotify_songs %>%
  select(danceability,
        acousticness,
         duration_ms,
        energy,
        instrumentalness,
        key,
        liveness,
        loudness,
        mode,
        speechiness,
        tempo,
        valence,
        year) %>%
  pivot_longer(-year, names_to = "components",
               values_to = "values")

 ggplot() +
    geom_point(data = char_long,
               aes(x = as.Date(year, format = "%Y"),
                 y = values,
                 color = components,
                 alpha = 0.5)) +
   
   geom_line(data = characteristics_mean,
             aes(x = year, 
                y = mean),
             size = 0.8) +
   geom_smooth(data = characteristics_mean,
             aes(x = year, 
                y = mean),
                color = "red") +
  facet_wrap(~components, scales = "free") +
   theme(legend.position = "none") +
   ggtitle("Trend of Music Components Overtime") +
  xlab("Year") +
  ylab("Values")
```

To answer the research question "is the music characteristic changing?", we plot the values of the different music components against year, and faceted according to the components. We can see from Figure \@ref(fig:components-trend) that there are some components which are changing over time.

Acousticness, mode, tempo and valence tend to decrease over time, while danceability and energy tend to increase. The decreasing valence indicates that new songs tend to be sadder as more and more unhappy songs are being released every year. "Happiness and brightness in music has declined, while sadness increased in the last 30 years or so" (France-Presse, 2018). Researches have suggested that the usage of positive emotions has declined. However, there is a high variability in valence values which means that there are varying types of songs. The increasing danceability and energy is due to the rising of electronic music. 

The increasing trend of energy and danceability is showing that the trend is shifting towards a more energetic and upbeat music. This is due to the rising of electronic music and the emergence of more modern music with high energy. The mode tends to get closer to 0.5 overtime, which means a more balanced mode between 0 and 1. Duration is pretty inetersting as it increased until around 1990 but then decreased again post-1990.

Other music components tend to follow a steady trend overtime. However, looking at instrumentalness, speechiness, liveness, and loudness, there has been more variances along time. Loudness tend to range between -20 to 0 decibels, except for some outliers present where the loudness is really low.

The music characteristics might change because of the emergence of new types and more modern music. But is the music characteristic also changing for an artist? It would be interesting to look at the trend to see if one specific artist also has a shift in his music characteristics. Is the same artist making the same kind of music through time?

To answer this question, we are looking at the top five artists and look at their music characteristics trend over time. We are not using the `track_popularity` to determine the top five artists here as some artists that are in the top five only have songs in a certain year, thus we are not able to compare the music characteristics over time. Therefore, we are using number of `track_name` instead. The following table display the top five aartists:

```{r topartists}
topartists <- spotify_songs %>% 
  group_by(track_artist) %>%
  summarize(Total = n_distinct(track_name)) %>% 
  arrange(desc(Total))  

head(topartists, 5) %>%
  kable()
```
Unlike the other four artists, Queen has a different music timeline. Therefore, for the purpose of having a clearer visualisation, we split Queen with the others.


```{r top4-wrangling}
top4artists <- spotify_songs %>%
  filter(track_artist == c("Martin Garrix", "David Guetta", "Logic", "Hardwell")) %>%
  select(danceability,
        acousticness,
        energy,
        instrumentalness,
        key,
        liveness,
        loudness,
        mode,
        speechiness,
        tempo,
        duration_ms,
        valence,
        year,
        track_artist)

top4_components <- top4artists %>%
  pivot_longer(danceability:valence, names_to = "components",
               values_to = "values") %>%
  group_by(year,
           track_artist,
           components) %>%
  summarise(mean = mean(values))

top4_components$year <- as.Date(top4_components$year, format = "%Y")         
```

```{r top4-components, fig.cap="The musical components of the top 5 artists (excluding Queen) over time."}
top4_components %>%
  group_by(year, track_artist) %>%
  ggplot() +
  geom_line(aes(x = year, 
                y = mean,
                color = track_artist)) +
  facet_wrap(~components, scales = "free") +
  ggtitle("Trend of music components of the top artists") +
  ylab("Values") +
  xlab("Year")
ggplotly()
```

It can be seen from Figure \@ref(fig:top4-components) that music components of the individual artist shift over time. Some components are pretty volatile. David Guetta, who is in both pop and edm genres, has a huge change in his danceability and energy. He tends to produce more music with lower danceability but higher energy these days. His songs also have lower duration compared to those in the past. The valence of his songs change overtime too - with 2010 and 2011 being the years when he produced more positive songs, and his songs tend to get less positive over the years. Hardwell focuses on edm, which explains the low speechiness. His instrumentalness used to be pretty high in 2013, however it is shifting towards zero over time. Unlike David Guetta, Hardwell tends to produce more positive songs these days.

Being a rapper, it makes sense that Logic has a very close to zero instrumentalness. The trend of key component in his music follows a decreasing trend over time. The valence, acousticness, and liveness of his songs are pretty volatile over time. One inetersting thing about Hardwell is that his danceability and tempo were decreasing in around 2016, indicating that he produced less upbeat and slower tempo music in this year. After 2016, his danceability and tempo are increasing again. Martin Garrix is an edm artist. He has a decreasing energy, loudness and duration over time. In 2013 and 2014, he produced music with a relatively high instrumentalness, however it dropped down across the years. Similar to Hardwell, Martin Garric creates more positive songs along the years - indicated by the increasing valence.

A clear thing to notice here is that all of them have a relatively low speechiness as they are all in either edm or rap genre. The most volatile component of all is mode.

```{r queen-wrangling}
queen <- spotify_songs %>%
  filter(track_artist == "Queen") %>%
  select(danceability,
        acousticness,
        energy,
        instrumentalness,
        key,
        liveness,
        loudness,
        mode,
        speechiness,
        tempo,
        duration_ms,
        valence,
        year,
        track_artist)

queen_components <- queen %>%
  pivot_longer(danceability:valence, names_to = "components",
               values_to = "values") %>%
  group_by(year,
           components) %>%
  summarise(mean = mean(values))

queen_components$year <- as.Date(queen_components$year, format = "%Y")         
```

```{r queen-trend, fig.cap="The musical components of Queen over time."}
queen_components %>%
  group_by(year) %>%
  ggplot() +
  geom_line(aes(x = year, 
                y = mean),
            color = "red") +
  facet_wrap(~components, scales = "free") +
  ggtitle("Trend of music components of Queen") +
  ylab("Values") +
  xlab("Year")
```

Figure \@ref(fig:queen-trend) is showing the music components of Queen's songs over time. And here we can see that the music characteristics evolve overtime. Queen is a rock band, hence explains the relatively high energy level. A very interesting thing here is that the danceability, energy, liveness, loudness, and speechiness are all dropping in 1992, while the acousticness is increasing sharply compared to the years before. This is due to Queen only produced one song in 1992 - the popular "We Are The Champions". This song is pretty different compared to other songs Queen produced as this song has less energy and less danceable. 

It can be concluded that the music characteristics evolve over time. And despite the changes, each artist has their own uniqueness in terms of the music they produce.

# Conclusion

Along with the shifts in music taste and trend, the music characteristics also appear to evolve. Modern music has higher danceability and energy compared to those in the past due to the emergence of more upbeat and more energetic music. Valence decreases over time as the music trend has shifted from happy and bright to sad ones. The are more variabilities of the music components over time. When looking at the top five artists with the most songs, the music characteristic of individual artists also change over time. 


# Reference
France-Presse, Agence. (2018). People prefer happy music but sad songs trend over the past 30 years – study. Retrieved from https://entertainment.inquirer.net/274757/people-prefer-happy-music-sad-songs-trend-past-30-years-study
